<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>购物车</title>
    <style>
        *{
            font-size: 20px;
        }
        table{
            width: 100%;
            height: 200px;
        }
        table, th, td {
            border: 1px solid black;
            border-collapse: collapse;
            padding: 0px;
            text-align: center;
        }
        th, td {

        }
        .red{
            color: #b31f1c;
        }
        .logo{
            width: 80px;
            height: 80px;
            padding: 0px;

        }
        .background{
            width: 100%;
            height: 290px;
        }
    </style>
    <script src="./js/vue.js" type="text/javascript"></script>
</head>
<body>
<div id="root">
    <div>
        <img src="./photo/背景.jpg" class="background" alt="没找到"/>
    </div>
    首页/购物车
    <div v-if="this.goods.length === 0">
        购物车空空如也~
    </div>
    <div v-else-if="this.goods.length > 0">
        <table>
            <caption>账单</caption>
            <thead>
            <tr>
                <th v-for="(item,index) in list" :key="item.id">{{item.name}}</th>
            </tr>
            </thead>
            <tr v-for="(item,index) in goods" :key="item.id">
                <td>{{index+1}}</td>
                <td><input type="checkbox" v-model:checked="item.isChecked"></td>
                <td><img src="photo/橙子.jpg" class="logo"></td>
                <td :class="{red:item.price < 10}">{{item.price}}</td>
                <td>
                    <button v-show="item.num > 0" @click="item.num--">-</button>
                    <span v-if="item.num > 0">{{item.num}}</span>
                    <button @click="item.num++">+</button>
                </td>
<!--                小计-->
                <td>{{item.price*item.num}}</td>
                <td><a @click.prevent="del(item.id)">删除</a></td>
            </tr>
        </table>
        <div>
            <button @click="chooseAll()">全选</button>
            <button @click="chooseReverse()">反选</button>
            <button @click="chooseReset()">重置</button>
            <span style="margin-left: 160px" v-show="this.totalPrice > 0">
            总价:<label>￥{{this.totalPrice}}</label>
            <button>结算{{this.totalCount}}</button>
            </span>
        </div>
    </div>
    <div v-else>
        发生错误,联系管理员解决吧!
    </div>
</div>
<script>
    const app = new Vue({
        el: '#root',
        data: {
            count: 0,
            list: [
                {id:1,name:'序号'},
                {id:2,name:'选中'},
                {id:3,name:'图片'},
                {id:4,name:'单价'},
                {id:5,name:'个数'},
                {id:6,name:'小计'},
                {id:7,name:'操作'}
            ],
            goods: JSON.parse(localStorage.getItem('goods')) || []
        },
        computed: {
            totalCount() {
                return this.goods.reduce((pre,cur) => {
                    return cur.isChecked ? pre+=cur.num : pre
                },0)
            },
            totalPrice(){
               return this.goods.reduce((pre,cur) => {
                    return cur.isChecked ? pre+=cur.price*cur.num : pre
                },0)
            }

        },
        methods: {
            del(id) {
                this.goods = this.goods.filter(item => item.id !== id)
            },
            chooseAll(){
                this.goods.forEach(element => {
                    element.num = 1
                    element.isChecked = true
                });
            },
            chooseReverse(){
                this.goods.forEach(element => {
                        element.isChecked = !element.isChecked
                });
            },
            chooseReset(){
                this.goods.forEach(element => {
                    element.num = 0
                    element.isChecked = false
                });
            }
        },
        watch: {
            goods: {
                deep: true,
                handler(newValue){
                    localStorage.setItem('goods',JSON.stringify(newValue))
                }
            }
        }
    });
</script>
</body>
</html>